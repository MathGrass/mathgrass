<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../../../img/favicon.ico" />
    <title>Frontend - Backend Communication - MathGrass</title>
    <link rel="stylesheet" href="../../../css/theme.css" />
    <link rel="stylesheet" href="../../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Frontend - Backend Communication";
        var mkdocs_page_input_path = "developer_guide/communication/communication.md";
        var mkdocs_page_url = null;
      </script>
    
    <script src="../../../js/jquery-3.6.0.min.js" defer></script>
    <!--[if lt IE 9]>
      <script src="../../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
      <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../../.." class="icon icon-home"> MathGrass
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption"><span class="caption-text">General</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../..">About this Project</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../features/">Teaching and Learning with MathGrass</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Deployment</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../deployment/">Deployment</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Developer Guide (general)</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../quickstart/">Quickstart</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../architecture/">Architecture</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../openapi/">OpenAPI Specification for MathGrass</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Developer Guide (Backend)</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../backend/concepts/">Concepts & Domain</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../backend/API_Implementation/">API Implementation</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../backend/evaluator/">Evaluator (Python)</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../backend/taskmanagement/">Task Management</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Developer Guide (Frontend)</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../frontend/">General</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../frontend/testing/">Testing</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../..">MathGrass</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../.." class="icon icon-home" aria-label="Docs"></a> &raquo;</li>
      <li>Frontend - Backend Communication</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="frontend-backend-communication">Frontend - Backend Communication</h1>
<h2 id="websockets-introduction">Websockets Introduction</h2>
<p>Besides the REST endpoints generated as explained in the <a href="../../backend/API_Implementation/">API implementation</a> a major
component of the frontend-backend communication is websockets. In short: Websockets are a way to establish a persistent
connection between a websocket server and websocket clients. Messages can be exchanged in both directions, which allows 
for many use cases. However, establishing a connection is more complex than a simple HTTP request and comes with a
larger overhead, which is why websockets is only used for only one case in the current implementation, which will be 
explained later. </p>
<h2 id="websocket-server">Websocket Server</h2>
<p>The websocket server is implemented using the <a href="https://docs.spring.io/spring-framework/docs/current/reference/html/web.html#websocket">Spring Websocket</a>
framework in the backend. The server is implemented as a Spring bean and is configured in the <code>WebSocketConfig</code> class. 
As with the current configuration, a connection can be established via <code>ws://HOST-URL:8080/ws</code>. Furthermore, there are
two important entry points:
* <code>/app</code> to send messages to the server
* <code>/topic</code> to subscribe to channels and receive messages from the server</p>
<p>The <code>WebSocketController</code> class is responsible for handling incoming messages and sending messages to the clients.
Currently there are two endpoints:
* <code>/app/sendMessage</code> to send a simple String message to the websocket server. This endpoint can be used for debugging purposes
* <code>/app/fetchAssessment</code> to request the evaluation of a submitted task. This use case is explained further later on</p>
<h2 id="websocket-client">Websocket Client</h2>
<p>The websocket client is implemented in the frontend part of the application. To make the usage websockets easier a 
<code>websocketService</code> has been implemented. The service is responsible for managing the connection to the websocket server,
as well as sending and receiving messages. The <code>websocketService</code> makes use of following libraries:
* <a href="https://github.com/sockjs/sockjs-client">SockJS</a> for connection management
* <a href="https://www.npmjs.com/package/webstomp-client">webstomp-client</a> for support of the STOMP protocol, which is used by the websocket server
* <a href="https://rxjs.dev/">RxJS</a> for subscription/observer functionalities</p>
<h2 id="task-evaluation-use-case">Task Evaluation Use Case</h2>
<p>Currently the only use case of using the websocket connection is to request the evaluation of a submitted task. Using
a simple HTTP endpoint for the request would result in a longpolling solution, since the task evaluation might take a 
while. To avoid the frontend from blocking, the websocket connection is a great alternative. The websocket connection is
only established in the <code>assessment</code> component. On creation of the component a connection to the websocket server is 
established. Once the component is unmounting the connection is closed again. Once a task has been submitted, a message
containing the task ID and the submitted answer is sent to the websocket server. The server responds with a 
<code>Task Result ID</code>, which can be used to actually retrieve the result. For that the client subscribes to a channel for
the respective task result ID. Once the server has finished the evaluation, the result is sent to the client by 
broadcasting the result to the respective channel. The client then unsubscribes from the channel and displays the result.</p>
<p><img alt="Task Evaluation Use Case" src="../../images/websocket_task_evaluation.png" /></p>
              
            </div>
          </div><footer>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
    
  </span>
</div>
    <script>var base_url = '../../..';</script>
    <script src="../../../js/theme_extra.js" defer></script>
    <script src="../../../js/theme.js" defer></script>
      <script src="../../../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
